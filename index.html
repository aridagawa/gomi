<!DOCTYPE html>
<htmllang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ごみの出し方検索（有田川町）</title>
</head>
<body>

<h2>有田川町のごみの出し方検索</h2>

<p>こちらでは有田川町におけるごみの出し方について検索できます。</p>
<p>ご注意：ごみ収集に出すごみ袋の重さは一袋につき８Kg以下になるようにしてください。</p>
<p>こちらのページでも不明な場合は役場環境衛生課までお問い合わせください。</p>

<label for="item">ごみの品目：</label>
<input type="text" id="item" name="item" placeholder="ごみの品目を入力（例「傘」...">
<button onclick="searchGarbageInfo()">検索</button>

<p id="searchResult"></p>

<script>
// ダウンロードするGZ形式のファイルのURL
var gzFileUrl = 'https://aridagawa.github.io/gomi/gomi.csv.gz';

// ファイルをダウンロードして展開し、CSVデータを取り込む関数
function downloadAndParseCSV() {
    fetch(gzFileUrl)
        .then(response => response.arrayBuffer())
        .then(buffer => {
            // pakoを使用してGZ形式のデータを展開する
            var inflatedData = pako.inflate(new Uint8Array(buffer), { to: 'string' });

            // 展開されたデータをCSVとして解釈する
            parseCSVData(inflatedData);
        })
        .catch(error => {
            console.error('Error downloading or parsing the file:', error);
        });
}

// CSVデータを解析する関数
//function parseCSVData(csvData) {
    // ここでCSVデータを適切に処理するコードを記述する
//    console.log(csvData);
//}

// ダウンロードと解析の開始
downloadAndParseCSV();

// CSVデータを処理する関数
function parseCSVData(csvData) {
  const lines = csvData.split('\n');
  return lines.map(line => line.split(','));
}

// CSVデータを処理します
const garbageData = processData(csvData);

// ごみ情報を検索する関数
function searchGarbageInfo() {
  var item = document.getElementById("item").value.trim().toLowerCase(); // ユーザー入力を取得し、前後の空白を削除して小文字に変換

  var searchResult = document.getElementById("searchResult");

  var found = false;
  var matchedItems = [];
  // CSVデータをループして、入力された品目と一部一致するかチェック
  for (var i = 0; i < garbageData.length; i++) {
    if (garbageData[i][0].toLowerCase().includes(item)) {
      matchedItems.push(garbageData[i]);
      found = true;
    }
  }

  if (found) {
    var searchInfo = matchedItems.map(item => {
　　　const additionalInfo = item[2] ? item[2] : "なし"; // 補足情報がない場合は「なし」と表示する
      return "・ごみの品目：" + item[0] + "、ごみの種類：" + item[1] + "、補足情報：" + additionalInfo;
    }).join('<br>');
    searchResult.innerHTML = searchInfo;
  } else {
    searchResult.textContent = "該当する情報はありません。表現や文字種を変えるなどして再検索してみてください。なお不明なものは役場環境衛生課までお問い合わせください。";
  }
}

// Enterキーを押すと検索が実行されるようにする
document.getElementById("item").addEventListener("keypress", function(event) {
  if (event.keyCode === 13) { // Enterキーのキーコードは13です
    event.preventDefault(); // デフォルトの動作を無効にする（フォームの送信を防ぐ）
    searchGarbageInfo(); // 検索を実行する
  }
});
</script>

</body>
</html>

